#summary Describe a framework for developing freestanding web pages for OLAC.

= Introduction =

Many OLAC pages are vulnerable to database server outage because they are dynamically generated from data that is dynamically read from the server. They also require more advanced web server configuration, e.g. PHP, CGI, WSGI, MySQL, etc.

OLAC data is not completely static, but it is close to static. The data is updated at most once a day. Thus, by going dynamic, we gain little while suffering from the issues.

In order to avoid the issues, the data needed for web pages is queried and stored on disk as files. This can be done on a regular-basis or whenever there is an update to the database. Then a thin layer of web data API is defined over the data files. Finally, DHTML web pages access the static data using the API via XMLHttpRequest.

(How is this better than generating static HTML directly off the database?)

= Overview =

The following diagram shows how the data stored in the database server flows to the client stating from OLAC DB, a MySQL database.

Data scripts are responsible for transforming data stored in OLAC DB into data files such as tab-delimited tables and XML files. The data files are static in the sense that they are not dynamically computed to serve real time HTTP requests. The computation usually consists of series of SQL queries and it is done offline in advance.

Each data file is configured with two configuration variables: data/VARNAME and data/VARNAME.script. The value of data/VARNAME is the location of the data file. The value of VARNAME.script is the location of a data script that generates the data file.

Here is an example. The config variable data/coverage contains the location of a data table need for the [http://www.language-archives.org/documents/coverage.html coverage page].

{{{
$ olacvar data/coverage
/olac/data/coverage/coverage.tab
}}}

The config variable data/coverage.script contains the location of the corresponding data script.

{{{
$ olacvar data/coverage.script
/olac/pkg/DataScripts/Current/generate_coverage_table.py
}}}

Therefore, the coverage table can be generated as follow.

{{{
$ $(olacvar data/coverage.script) > $(olacvar data/coverage)
}}}


{{{
              OLAC DB
                 |
                 | Data scripts
                 |
         Static data files
                 |
                 |
                 |
              PyWebAPI
               |    |
               |    |
          ,----'    `-----------.
          |                     |
          |                     | JSON scripts
          |                     |
       srv.wsgi         Static JSON files
}}}

 * OLAC DB - data stored on a database server
 * Static data files - tab delimited tables, XML files, etc. computed from OLAC DB
 * Static JSON files - pieces of information computed from the static data files and represented in JSON

 * DataScripts - reads data from OLAC DB and produces static data files
 * PyWebAPI - Python API over the static data files
 * srv.wsgi - exposes PyWebAPI for web clients
 * JsonScripts - for each PyWebAPI function, for every possible input to the function, calls the function and save the return value as a file
